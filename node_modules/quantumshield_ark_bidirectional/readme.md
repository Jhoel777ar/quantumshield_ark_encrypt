# QuantumShield Ark Bidirectional

[![npm version](https://img.shields.io/npm/v/quantumshield_ark_bidirectional)](https://www.npmjs.com/package/quantumshield_ark_bidirectional)
![TypeScript](https://img.shields.io/badge/TypeScript-Supported-blue)
![License: MIT](https://img.shields.io/badge/License-MIT-green)

QuantumShield Ark Bidirectional es una librería WebAssembly escrita en Rust para encriptación y desencriptación seguras, con resistencia parcial a ataques cuánticos. Ideal para aplicaciones web que requieren criptografía robusta y ligera.

## Características
- **Criptografía Híbrida**
- **Resistencia Post-Cuántica Parcial**: Capa de 8192 rondas para proteger contra ataques cuánticos como Shor.
- **WebAssembly Optimizado**: Binario ligero (~400 KB) para navegadores modernos.
- **API Simple**: Fácil de integrar en proyectos JavaScript/TypeScript.
- **Límite de Texto**: Hasta 10 MB por mensaje.

## Instalación
Instala el paquete vía npm:

```bash
npm i quantumshield_ark_bidirectional
```

## Uso
La librería proporciona funciones para generar pares de claves (`wasm_generate_keypair`), encriptar (`wasm_encrypt`) y desencriptar (`wasm_decrypt`) mensajes. Los datos se manejan en formato binario (Uint8Array) y hexadecimal.

### Ejemplo en JavaScript
```javascript
import init, { wasm_generate_keypair, wasm_encrypt, wasm_decrypt } from 'quantumshield_ark_bidirectional';

async function run() {
  // Inicializar WebAssembly
  await init();

  // Generar par de claves
  const keypair = wasm_generate_keypair();
  const x25519_pub = new Uint8Array(keypair.x25519_pub);
  const x25519_sec = new Uint8Array(keypair.x25519_sec);
  const ed25519_pub = new Uint8Array(keypair.ed25519_pub);
  const ed25519_sec = new Uint8Array(keypair.ed25519_sec);

  // Encriptar
  const plaintext = "Mensaje secreto";
  const seed = new TextEncoder().encode("user_123");
  const ciphertext = wasm_encrypt(plaintext, x25519_pub, ed25519_sec, seed);
  
  // Convertir a hexadecimal
  const ctHex = Array.from(ciphertext).map(b => b.toString(16).padStart(2, '0')).join('');
  console.log("Ciphertext:", ctHex);

  // Desencriptar
  const decrypted = wasm_decrypt(ciphertext, x25519_sec, ed25519_pub);
  console.log("Decrypted:", decrypted); // "Mensaje secreto"
}

run().catch(console.error);
```

### Ejemplo en HTML
```html
<!DOCTYPE html>
<html>
<head>
  <title>QuantumShield Demo</title>
</head>
<body>
  <input type="text" id="plaintext" placeholder="Mensaje">
  <input type="text" id="seed" placeholder="Seed (opcional)">
  <button id="encrypt">Encriptar</button>
  <input type="text" id="ciphertext" placeholder="Ciphertext (hex)">
  <input type="text" id="x25519_sec" placeholder="X25519 Secret Key (hex)">
  <input type="text" id="ed25519_pub" placeholder="Ed25519 Public Key (hex)">
  <button id="decrypt">Desencriptar</button>
  <div id="result"></div>

  <script type="module">
    import init, { wasm_generate_keypair, wasm_encrypt, wasm_decrypt } from './node_modules/quantumshield_ark_bidirectional/quantumshield.js';

    async function initWasm() {
      await init();
      console.log('WASM loaded');
    }
    initWasm();

    function hexEncode(bytes) {
      return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function hexDecode(hex) {
      const bytes = new Uint8Array(hex.length / 2);
      for (let i = 0; i < hex.length; i += 2) {
        bytes[i / 2] = parseInt(hex.substr(i, 2), 16);
      }
      return bytes;
    }

    document.getElementById('encrypt').addEventListener('click', async () => {
      const plaintext = document.getElementById('plaintext').value;
      const seed = document.getElementById('seed').value || 'default_seed';
      const resultDiv = document.getElementById('result');

      try {
        const keypair = wasm_generate_keypair();
        const x25519_pub = new Uint8Array(keypair.x25519_pub);
        const x25519_sec = new Uint8Array(keypair.x25519_sec);
        const ed25519_pub = new Uint8Array(keypair.ed25519_pub);
        const ed25519_sec = new Uint8Array(keypair.ed25519_sec);

        const ciphertext = wasm_encrypt(plaintext, x25519_pub, ed25519_sec, new TextEncoder().encode(seed));
        const ctHex = hexEncode(ciphertext);

        resultDiv.innerHTML = `
          <p><strong>Ciphertext:</strong> ${ctHex}</p>
          <p><strong>X25519 Public:</strong> ${hexEncode(x25519_pub)}</p>
          <p><strong>X25519 Secret:</strong> ${hexEncode(x25519_sec)}</p>
          <p><strong>Ed25519 Public:</strong> ${hexEncode(ed25519_pub)}</p>
          <p><strong>Ed25519 Secret:</strong> ${hexEncode(ed25519_sec)}</p>
        `;
      } catch (e) {
        resultDiv.innerHTML = `<p style="color: red;">Error: ${e}</p>`;
      }
    });

    document.getElementById('decrypt').addEventListener('click', async () => {
      const ctHex = document.getElementById('ciphertext').value;
      const x25519SecHex = document.getElementById('x25519_sec').value;
      const ed25519PubHex = document.getElementById('ed25519_pub').value;
      const resultDiv = document.getElementById('result');

      try {
        const ciphertext = hexDecode(ctHex);
        const x25519_sec = hexDecode(x25519SecHex);
        const ed25519_pub = hexDecode(ed25519PubHex);
        const plaintext = wasm_decrypt(ciphertext, x25519_sec, ed25519_pub);
        resultDiv.innerHTML = `<p><strong>Decrypted:</strong> ${plaintext}</p>`;
      } catch (e) {
        resultDiv.innerHTML = `<p style="color: red;">Error: ${e}</p>`;
      }
    });
  </script>
</body>
</html>
```

## Configuración de Seguridad
- **Feature `secure`**: Activa optimizaciones adicionales para entornos WebAssembly (e.g., `console_error_panic_hook`). Compila con:
  ```bash
  wasm-pack build --target web --release -- --features secure
  ```
- **Límite de Texto**: Máximo 10 MB para prevenir ataques DoS.
- **Resistencia Cuántica**: La capa de 8192 rondas de `SHA-512` y `Argon2id` protege contra ataques cuánticos como Shor, aunque `X25519` y `Ed25519` no son totalmente post-cuánticos.

## Requisitos
- Node.js para instalar el paquete.
- Navegador moderno con soporte para WebAssembly.

## Licencia
GPL-3.0

## Contacto
Para soporte o consultas, abre un issue en [GitHub](https://github.com/tu-repo/quantumshield).

## Nota
Este paquete está diseñado para aplicaciones web seguras. No modifiques el código fuente para mantener la integridad criptográfica.